<form id="test_form" >
  <input type="file" id="inputimage" accept="image/*">
  <img id="myImg" src="#" alt="your image" />
</form>
<div id="map" style="width:100%; height:100%; position:absolute; top:0;"></div>


<style type="text/css">
            
            #imgcontainer {
              position:relative;
              width: 100%;
              height: 100%;
              overflow: clip;
            }

            #img1 {
              position: absolute;
              top: 0px;
              left: 0px;
              transform-origin: 0 0;
              -webkit-transform-origin: 0 0;
              -moz-transform-origin: 0 0;
              -o-transform-origin: 0 0;
            }
            
            .corner {
              position: absolute;
              top: 0px; left: 0px;
            }
            
            #map{
            	border: 2px solid;
            }
			
			
		#inputimage
		{
		position:absolute; 
		top:-100px;
		}
		
</style>

<script>

		var map = new L.map('map').setView([51.505, -0.09], 13);
		var imageBounds=[];
		var markers=[];
		var draggable={};
		var newimg;

		L.tileLayer('https://{s}.tiles.mapbox.com/v3/anishshah101.ipm9j6em/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'examples.map-i86knfo3'
		}).addTo(map);


			
          L.easyButton('fa-file-image-o', 
              function (){
                $("#inputimage").click();
                },
             'Upload image'
            );
            
         	L.easyButton('fa-adjust', 
              function (){
                changeopacity();
                },
             'Toggle Image Transparency'
            );
          
          L.easyButton('fa-circle-o', 
             function (){
                outline();
                },
             'Outline'
            );
          
          L.easyButton('fa-bitbucket', 
              function (){
                map.removeLayer(newimg);
                for(var i=0; i<4; i++)
                map.removeLayer(markers[i]);
                },
             'Delete Image'
            );
            
          
            
          $(":file").change(function () {
        	if (this.files && this.files[0]) {
            var reader = new FileReader();
            reader.onload = imageIsLoaded;
            reader.readAsDataURL(this.files[0]);
        		}
		});
		
		
		function imageIsLoaded(e) {
		    $('#myImg').attr('src', e.target.result);
			corners = [300, 200, 500, 200, 300, 400, 500, 400];
			for(var i=0; i<8; i=i+2)
			{
				var a=map.layerPointToLatLng([corners[i],corners[i+1]]);
				var marker = new L.ImageMarker([a.lat, a.lng]).addTo(map);
				markers.push(marker);
				imageBounds.push([a.lat,a.lng]);
				var addidclass=marker._icon;
				addidclass.id= "marker"+i;
				addidclass.className = addidclass.className + " corner";
			}
			
			newimg= new L.DistortableImage(e.target.result, imageBounds);
			(newimg.bringToFront()).addTo(map);
			
			draggable = new L.Draggable(newimg._image);
			draggable.enable();
			
			draggable.on('dragend', function(e){
				var target=e.target;
			  	for(var i=0;i<4;i=i+1)
				  {
				  	var htmlpos= map.latLngToContainerPoint(markers[i]._latlng);
				  	htmlpos.x=htmlpos.x - (target._startPos).x + (target._newPos).x;
				  	htmlpos.y=htmlpos.y - (target._startPos).y + (target._newPos).y;
				  	var mappos= map.containerPointToLatLng(htmlpos);
				  	markers[i].setLatLng(mappos);
				  }
				}
			);
			
			
			for (i in markers) {
                markers[i].on('drag', update);
            	}
		    
		};
            
			
</script>
